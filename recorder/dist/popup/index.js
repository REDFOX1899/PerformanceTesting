(()=>{"use strict";var e={849:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getBackgroundPage=function(){return chrome.extension.getBackgroundPage()}},1045:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.configFile=void 0,o.localSave=function(e){chrome.storage.local.set(e).catch((()=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message)}))},o.ApiClientIdentification=function(){return"_clientId=BE_CHROME&_clientVersion="+r.version},o.validateMatchPattern=function(e){return!0},o.openPopup=function(e,o,t,r,a,l){(0,n.isMacintosh)()||(o+=16);const c={url:chrome.runtime.getURL(e),type:"panel",width:o,height:t,left:a,top:l};chrome.windows.create(c).then((e=>new Promise((()=>{const o=(t,n)=>{"complete"===n.status&&t===e.tabs[0].id&&(r(e),chrome.tabs.onUpdated.removeListener(o))};chrome.tabs.onUpdated.addListener(o)}))))};const n=t(2930),r=chrome.runtime.getManifest();o.configFile="/config.json","mbopgmdnpcbohhpnfglgohlbhfongabi"!==chrome.runtime.id&&(o.configFile="/config_dev.json")},2930:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isMacintosh=function(){return navigator.platform.indexOf("Mac")>-1},o.isWindows=function(){return navigator.platform.indexOf("Win")>-1}},9279:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.stringIsEmpty=function(e){return!/\S/.test(e)},o.titleCase=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},o.stripTrailingSlash=function(e){return e?e.replace(/\/+$/g,""):e}},9505:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.validUrl=function(e){return/^(http|https|ftp):\/\/[a-z0-9]+([\-.][a-z0-9]+)*(:[0-9]{1,5})?(\/.*)?$/i.test(e)},o.parseURL=function(e){if(null==e||0===e.length)return"";const o={},t=e.indexOf("://"),n=e.substr(t+3,e.length);let r=n.indexOf("/");r=-1===r?n.length:r,o.domain=n.substr(0,r);const a=o.domain.split(".");switch(a.length){case 2:o.host=a[0],o.tld=a[1];break;case 3:o.host=a[1],o.tld=a[2];break;case 4:o.host=a[1],o.tld=a[2]+"."+a[3]}return o.host+"."+o.tld}}},o={};function t(n){var r=o[n];if(void 0!==r)return r.exports;var a=o[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(()=>{const e=t(849),o=t(1045),n=t(9279),r=t(9505),a=chrome.runtime.getManifest();let l="stopped",c={};const s="Please log in or sign up to continue.",i="Adjust your properties and run tests from the cloud. The domains filter list must be completed before you click this button.",d="Click to run JMeter test from the cloud now.",p="Adjust test properties and run from the cloud.",u='Set the time interval during which FollowMe\'s virtual users will start "following" your online activity. The virtual users will join randomly during this specified period.',m="Start recording",h="Resume recording";let f="",g=null,w="",b="",_=[],v=[],k=[];const y=[],x=[],B=[];let j;const S="eu-west-1",O=50,M=1e4,C=18e3;let T=null,I=!1;const E="v4";let P=!1;(0,e.getBackgroundPage)();function N(){const e=$("#follow-name").val(),o=$("#regex_follow_input").val();!I||(0,n.stringIsEmpty)(e)||(0,n.stringIsEmpty)(o)?$.disableBtn("follow-record"):$.enableBtn("follow-record"),$.enableBtn("follow-reset"),$.disableBtn("follow-stop"),$.disableBtn("follow-pause"),$.disableBtn("follow-upload-jmx"),$.disableBtn("follow-report")}function R(e){$("#recording-actions").show(),!0===e&&$("#recording-actions").addClass("opened")}function A(e){$("#recording-actions").hide(),!0===e&&$("#recording-actions").removeClass("opened")}function q(e){$("#record .button_big_style > input").attr("title",e)}function D(){$.enableBtn("record"),$.enableBtn("reset"),$.disableBtn("pause"),$.disableBtn("stop"),$.disableBtn("edit"),$.disableBtn("debugger"),$.disableBtn("download"),$.disableBtn("upload"),$.disableBtn("upload-jmx"),$.disableBtn("upload-functional"),A(),q(m)}function L(e){e?($("#button-upload-jmeter").show(),$("#button-upload-selenium").hide()):($("#button-upload-jmeter").hide(),$("#button-upload-selenium").show())}chrome.storage.local.set({selected_domains:{}}),chrome.action.setBadgeText({text:""}),chrome.storage.local.get("server",(e=>w=e.server)),$(document).ready((function(){$("#load-origin").chosen(),$("#parallel-downloads-list").chosen({width:"245px"});const e=new Swiper(".swiper-container",{simulateTouch:!1,effect:"fade",init:!1});function t(){chrome.tabs.query({},(e=>{for(const o of e)chrome.tabs.sendMessage(o.id,{msg:"removeTransactionPopup"}).catch((()=>{}))}))}e.on("init",(()=>{!function(){try{new ResizeObserver((e=>{for(const o of e)if(!$("#run-overlay").is(":visible")){$("html,body").scrollTop(0);const e=o.contentRect.height;window.parent.postMessage({height:e},"*")}})).observe(document.querySelector(".swiper-slide-active"))}catch(e){$(".swiper-slide-active").on("resize",(function(){if(!$("#run-overlay").is(":visible")){const e=$(this).height();window.parent.postMessage({height:e},"*")}}))}}()})),e.init(),$("html, body").css({height:"auto"}),chrome.runtime.sendMessage({type:"stop_blinking"}).catch((()=>{}));const U=$(".regex-wrapper"),J=$(".swiper-slide-next");function Y(){const e=$("#user-agent-wrapper"),o=$("#origin-wrapper"),t=$("#concurrency-wrapper");"mode-follow"===f?(o.show(),t.show(),e.addClass("test-options-position-absolute"),o.addClass("test-options-position-absolute")):(o.hide(),t.hide(),e.removeClass("test-options-position-absolute"),o.removeClass("test-options-position-absolute"))}U.on("focusin",(()=>{J.css({display:"none"})})),U.on("focusout",(()=>{J.css({display:"block"})})),setTimeout(Y,100),chrome.storage.local.get((e=>{e.hasOwnProperty("permissionsBlockFirstTimeShow")&&e.permissionsBlockFirstTimeShow&&chrome.storage.local.set({permissionsBlockFirstTimeShow:!1})})),document.querySelectorAll(".notification-text-alert .close-open-button.open-button").forEach((e=>{e.onclick=()=>{const o=e.closest(".notification-text-alert-inner"),t=o.querySelector(".notification-text-hide-block"),n=o.querySelector(".close-open-button.close-button");$(t).fadeIn(300),$(e).fadeOut(100),$(n).css("display","flex").fadeIn(300)}}));const G=document.querySelectorAll(".notification-text-alert .close-open-button.close-button");function H(){G.forEach((e=>e.onclick()))}function W(e){(0,o.localSave)({accountOptions:{account:j?.accountId,workspace:j?.workspaceId,project:j?.id,uid:g}}),e&&($("#account-status").text(""),$("#options-fieldset-test").removeClass("not-saved"),$("#accounts").val(j.accountId).trigger("chosen:updated"),P=!1,X(j.accountId),oe(j.accountId,j.workspaceId),$(".account-loader").show(),$(".account-expand").hide())}function z(e){$.ajax({type:"GET",contentType:"application/json",url:`${w}/api/${E}/projects?workspaceId=${e}&limit=1000&${(0,o.ApiClientIdentification)()}`,dataType:"json",success:o=>{const t=o.result,n=$("#projects");n.empty(),$.each(t,((o,t)=>{t.workspaceId===e&&(n.append('<option class="'+t.workspaceId+'" value="'+t.id+'">'+t.name+"</option>"),B.push(t.id))})),n.chosen({width:"170px"}),P?n.val($("#projects option:first").val()).trigger("chosen:updated"):chrome.storage.local.get("accountOptions",(e=>{e.hasOwnProperty("accountOptions")&&g===e.accountOptions.uid&&e.accountOptions.account&&e.accountOptions.workspace&&e.accountOptions.project?$("#projects").val(e.accountOptions.project).trigger("chosen:updated"):($("#projects").val(j.id).trigger("chosen:updated"),W(!1)),$(".project-name").text($("#projects option:selected").text())})),Z(!0)},error:e=>{Q(e)}})}function X(e){$.ajax({type:"GET",contentType:"application/json",url:w+"/api/v4/workspaces?limit=0&skip=0&accountId="+e+"&enabled=true?"+(0,o.ApiClientIdentification)(),dataType:"json",success:o=>{const t=o.result,n=$("#workspaces");let r=!1;n.empty(),$.each(t,(function(o,t){t.accountId===e&&(n.append('<option class="'+t.accountId+'" value="'+t.id+'">'+t.name+"</option>"),x.push(t.id))})),n.chosen({width:"170px"}),P?(n.val($("#workspaces option:first").val()).trigger("chosen:updated"),z(Number(n.val()))):chrome.storage.local.get("accountOptions",(e=>{e.hasOwnProperty("accountOptions")&&g===e.accountOptions.uid&&e.accountOptions.account&&e.accountOptions.workspace&&e.accountOptions.project?(z(e.accountOptions.workspace),$("#workspaces").val(e.accountOptions.workspace).trigger("chosen:updated")):r=!0,r&&(z(j.workspaceId),$("#workspaces").val(j.workspaceId).trigger("chosen:updated"),W(!1))}))},error:e=>{Q(e)}})}function Q(e){Z(!0),e?.responseJSON?.hasOwnProperty("error")&&$(".account-expand").html('<p class="account-options-error">Error loading account! <br>'+e.responseJSON.error.message+"</p>")}function V(){let e=!1;$.ajax({type:"GET",contentType:"application/json",url:w+"/api/v4/accounts?"+(0,o.ApiClientIdentification)(),dataType:"json",success:o=>{const t=o.result,n=$("#accounts");n.empty(),$.each(t,((e,o)=>{n.append('<option value="'+o.id+'">'+o.name+"</option>"),y.push(o.id)})),n.chosen({width:"170px"}),chrome.storage.local.get("accountOptions",(o=>{o.hasOwnProperty("accountOptions")&&g===o.accountOptions.uid&&o.accountOptions.account&&o.accountOptions.workspace&&o.accountOptions.project?(X(o.accountOptions.account),$("#accounts").val(o.accountOptions.account).trigger("chosen:updated"),oe(o.accountOptions.account,o.accountOptions.workspace),te(o.accountOptions.project)):e=!0,e&&(X(j.accountId),oe(j.accountId,j.workspaceId),te(j.id),$("#accounts").val(j.accountId).trigger("chosen:updated"),W(!1))}))},error:e=>Q(e)})}function K(e,o){e?e.length>8&&(e=$.trim(e).substring(0,8).slice(0,-1)+"..."):e="user";const t=$("#signed-block");$("#sign-block").hide(),t.show(),t.html(`<div class='welcome'>Hi <a href='${w}/app' target='_blank'>${e}</a></div>`),chrome.storage.local.set({logged:!0,username:e,uid:o}),g=o,I=!0,chrome.runtime.sendMessage({op:"reloadoptions"}).catch((()=>{})),$("#update-settings").is(":checked")?($("#button-upload-jmeter input").attr("title",i),$("#upload-off input").attr("title",s)):($("#button-upload-jmeter input").attr("title",d),$("#upload-off input").attr("title",d),$("#follow-record-off input").attr("title",i)),(0,n.stringIsEmpty)($("#follow-name").val())&&!(0,n.stringIsEmpty)($("#regex_follow_input").val())&&"stopped"===l&&$.enableBtn("follow-record"),chrome.runtime.sendMessage({type:"get_status"}).then((e=>{l=e.op,chrome.runtime.sendMessage({type:"traffic_exists"}).then((e=>{chrome.storage.local.get("record_name",(o=>{e&&"stopped"===l&&o.record_name&&!(0,n.stringIsEmpty)(o.record_name)&&(I&&$.enableBtn("upload"),$.enableBtn("upload-jmx"))}))})).catch((()=>{}))})).catch((()=>{}))}function Z(e){e?($(".account-loader").hide(),$(".account-expand").show()):($(".account-loader").show(),$(".account-expand").hide())}function ee(){v.length>0&&("follow"!==l&&"pause"!==l&&I?chrome.storage.local.get(null,(e=>{const t=e.concurrency,n=$("#concurrency");let r=e.account_plan.concurrency;const a=(l=e.location,v.find((e=>e.id===l)));var l;a&&a.limits&&a.limits.concurrency<r&&(r=a.limits.concurrency),"mode-record"===f&&r>C&&(r=C),"mode-follow"===f&&r>M&&(r=M),r<t?((0,o.localSave)({concurrency:r}),n.slider("option","value",r),n.slider("option","max",r),(0,o.localSave)({real_max_follow_limit:r}),$("#concurrency-display-textfield").val(r)):(n.slider("option","value",t),n.slider("option","max",r),(0,o.localSave)({real_max_follow_limit:r}),$("#concurrency-display-textfield").val(t)),n.slider({disabled:!1})})):$("#concurrency").slider({disabled:!1}))}function oe(e,t){$.ajax({type:"GET",contentType:"application/json",url:`${w}/api/${E}/accounts/${e}?${(0,o.ApiClientIdentification)()}`,dataType:"json",success:e=>{chrome.storage.local.get(null,(()=>{const n=e.result,r=n.plan.concurrency,a=Math.min(r,M);var c;(0,o.localSave)({account_plan:n.plan,duration:n.plan.duration,real_max_follow_limit:a,features:n.features}),c=t,$.ajax({type:"GET",contentType:"application/json",url:w+"/api/v4/workspaces/"+c+"?"+(0,o.ApiClientIdentification)(),dataType:"json",success(e){const o=e.result.locations;$("#load-origin").html(""),v=[],k=[],o.forEach((e=>{!1===e.sandbox&&(v.push({title:e.title,id:e.id,limits:e.limits}),e.hasOwnProperty("purposes")&&e.purposes.functional&&k.push({title:e.title,id:e.id,limits:e.limits}))})),$("#functional-test").is(":checked")&&"mode-follow"!==f?ve():ke(),$("#load-origin").trigger("chosen:updated")},error:()=>{$.elementStatus.html("Error loading locations!")}}),chrome.runtime.sendMessage({type:"get_status"}).then((e=>{if(l=e.op,"stopped"!==l&&("mode-follow"===f||"mode-record"===f&&"mode-follow"===b))chrome.storage.local.get("max_concurrent_users",(e=>{T=e.max_concurrent_users}));else{const e={max_follow_limit:Math.min(n.plan.concurrency,M),max_record_limit:Math.min(n.plan.concurrency,C)};(0,o.localSave)(e),T="mode-follow"===f?e.max_follow_limit:e.max_record_limit}})).catch((()=>{}))}))}})}function te(e){$(".project-name").text($("#projects option:selected").text()),$.ajax({type:"GET",contentType:"application/json",url:`${w}/api/${E}/tests?projectId=${e}&${(0,o.ApiClientIdentification)()}`,dataType:"json",success:e=>function(e){_=[];const t=[],n=[],r=$("#functional-test").is(":checked");e.result.forEach((e=>{const o=e.configuration.type;"followme"===o?(t.push({value:e.name+" (id: "+e.id+")",test_id:e.id}),_[e.id]=e.name+" (id: "+e.id+")"):("taurus"!==o||r)&&("functionalApi"!==o||r)||(n.push({value:e.name+" (id: "+e.id+")",test_id:e.id}),_[e.id]=e.name+" (id: "+e.id+")")})),$.elementName.autocomplete({lookup:n,lookupLimit:5,onSelect(e){const t=e.value;(0,o.localSave)({record_name:t}),chrome.storage.local.set({record_id:e.test_id}),console.log("something happend??")}}),$("#follow-name").autocomplete({lookup:t,lookupLimit:5,onSelect:e=>{const t=e.value;(0,o.localSave)({test_name:t,jmxname:t})}})}(e)})}function ne(e){let t=10;e<=1e3&&e>100?t=20:e<=1e4&&e>1e3?t=60:e>1e4&&(t=300),re(t,!0),(0,o.localSave)({auto_time_distribution:t})}function re(e,o){let t;if(e<60)t=e+"s";else{const o=Math.floor(e/60),n=e-60*o;t=o+"m "+n+"s",n<1&&(t=o+"m ")}o&&(t+=" Auto"),$(".time-distribution-display .text").html(t)}function ae(e){const o=$("#concurrency-display-textfield");isNaN(e)&&(e=O,o.val(O)),o.val(e)}function le(e){chrome.storage.local.get("time_distribution",(t=>{(0,o.localSave)({concurrency:e}),0===t.time_distribution&&ne(e)}))}function ce(){chrome.storage.local.get(null,(e=>{chrome.storage.local.get(null,(t=>{let n;const r=$(".onoffswitch-checkbox");let a;"TRUE"===t.disable_followme&&(f="mode-record",chrome.storage.local.set({mode:f}),chrome.runtime.sendMessage({type:"switch_mode"}).catch((()=>{}))),chrome.runtime.sendMessage({type:"has_current_suite"}).then((e=>{"mode-record"===f&&e&&"stopped"===l?R(!1):A(!0)})).catch((()=>{})),"mode-follow"===f?(n="max_follow_limit",$(".time-distribution-wrapper").show(),$("#follow-wrapper").show(),$("#record-wrapper").hide(),$(".domains-to-follow-wrapper").show(),r.val("mode-follow"),r.attr("checked","checked"),$(".update-settings-wrapper").hide(),$(".cookie-wrapper").hide(),$(".record-cookies-wrapper").hide(),$(".random-think-time-wrapper").show(),$(".css-wrapper").hide(),$(".js-wrapper").hide(),$(".images-wrapper").hide(),$(".ajax-wrapper").hide(),$(".functional-test-wrapper").hide(),$(".other-wrapper").hide(),$(".regex-wrapper").hide(),$(".autolabel-transactions-wrapper").hide(),$(".top-level-wrapper").hide(),$(".following-wrapper").hide(),$(".following").show(),$(".parallel-downloads-wrapper").hide(),$(".parallel-downloads-text").hide(),$(".requests").hide(),$(".transactions-wrapper").hide(),$(".following").addClass("followme"),$("#test-configuration").addClass("followmode"),$("#test-configuration").removeClass("recordmode"),$("#advanced-options").addClass("followmode"),$("#advanced-options").removeClass("recordmode"),$(".regex-follow-wrapper").show(),$(".mode-record").attr("id","not-current"),$(".mode-follow").attr("id","current"),$("#mode").val("mode-record"),$("#functional-test").is(":checked")&&ke()):(n="max_record_limit",$("#record-wrapper").show(),$(".domains-to-follow-wrapper").hide(),$("#test-configuration").addClass("recordmode"),$("#test-configuration").removeClass("followmode"),$("#advanced-options").addClass("recordmode"),$("#advanced-options").removeClass("followmode"),$(".time-distribution-wrapper").hide(),$(".top-level-wrapper").show(),$(".following-wrapper").show(),$(".transactions-wrapper").show(),$("#follow-wrapper").hide(),$("#add-concurrency").hide(),r.val("mode-record"),r.removeAttr("checked"),$(".update-settings-wrapper").show(),$(".cookie-wrapper").show(),$(".record-cookies-wrapper").hide(),$(".random-think-time-wrapper").show(),$(".css-wrapper").show(),$(".js-wrapper").show(),$(".images-wrapper").show(),$(".ajax-wrapper").show(),$(".functional-test-wrapper").show(),"top_level_and_following"!==$("input[name='requests_to_record']:checked").val()&&($(".following").hide(),$(".parallel-downloads-wrapper").show(),"other"===$("#parallel-downloads-list").find(":selected").val()&&$(".parallel-downloads-text").show()),$("#edit-transaction-labels").is(":checked")&&($(".autolabel-transactions-wrapper").show(),$(".swiper-container").css({overflow:"visible"})),$(".requests").show(),$(".following").removeClass("followme"),$(".other-wrapper").show(),$(".regex-follow-wrapper").hide(),$(".regex-wrapper").show(),$(".mode-record").attr("id","current"),$(".mode-follow").attr("id","not-current"),$("#mode").val("mode-follow"),$("#functional-test").is(":checked")&&ve(),$("#advanced-options").hasClass("openedRecord")?_e():be(),$("#recording-actions").hasClass("opened")&&R(!1)),e=e||{};const c=$("#concurrency"),s=c.slider("option","value");let i;if("stopped"!==l&&"mode-follow"===f)return void chrome.storage.local.get("max_concurrent_users",(e=>{c.slider("option","max",e.max_concurrent_users);const t=Math.min(s,e.max_concurrent_users);c.slider("option","value",t),$("#concurrency-display-textfield").val(t),ae(t),le(t),(0,o.localSave)({concurrency:t}),$("#add-concurrency").hide()}));if("stopped"===l&&"mode-follow"===f&&I)i=e.real_max_follow_limit;else if(I&&"mode-follow"===f)a=100;else if(a=e[n],!a)return;const d=Math.min(s,a);c.slider("option","value",d),"mode-follow"===f&&a!==i&&"stopped"===l&&I||$("#add-concurrency").hide(),ae(d),le(d),"0"===e.time_distribution?ne(s):(re(e.time_distribution),$("#time-distribution").slider("option","value",e.time_distribution))})),ee(),Y()})),"mode-follow"===f&&document.getElementById("mode").click()}function se(){chrome.storage.local.get(null,(e=>{w=e.server,setTimeout((()=>{$(".main_popup").show(),$(".loader").hide()}),1500),$(".welcome a").attr("href",w+"/app/")}))}function ie(){const e=$("#signed-block"),t=$("#concurrency"),n=$("#concurrency-display-textfield");$("#options-fieldset-test").addClass("disabled-section"),$(".main_popup").show(),$(".loader").hide(),$("#sign-block").show(),e.hide(),e.html(""),t.slider({disabled:!1}),n.val()&&"null"!==n.val()||(n.val(O),t.slider("value",O)),(0,o.localSave)({real_max_follow_limit:100}),chrome.storage.local.set({logged:!1}),chrome.runtime.sendMessage({op:"reloadoptions"}).catch((()=>{})),I=!1,$.disableBtn("upload"),$.disableBtn("upload-jmx"),$.disableBtn("follow-upload-jmx"),$.disableBtn("follow-report"),$.disableBtn("follow-record"),$("#upload-off input").attr("title",s),$("#follow-record-off input").attr("title",s),$("#upload-jmx-off input").attr("title",s),$(".signup").attr("href",w+"/app/sign-up?app=chrome&ver="+a.version),$(".login").attr("href",w+"/app/sign-in?app=chrome&ver="+a.version),(0,o.localSave)({accountOptions:{account:null,workspace:null,project:null,uid:null},account_plan:null,account_info:null,features:null})}function de(e,t){$.ajax({type:"GET",contentType:"application/json",url:e+"/api/v4/user?"+(0,o.ApiClientIdentification)(),dataType:"json",success(t){(0,o.localSave)({server:e,account_info:t.result}),setTimeout((()=>{$.elementStatus.html("")}),2500),se(),chrome.storage.local.get("theme",(e=>{V(),K(t.result.name,t.result.id),j=t.result.defaultProject,ce()}))},error:()=>{console.log("userLoad error"),ie(),t||"https://loadtest.dynatrace.com"===e?chrome.storage.local.get("theme",(e=>{console.log("userLoad error if 2")})):($("#options-fieldset-test").removeClass("disabled-section"),pe(!0),console.log("userLoad error if 1"))}})}function pe(e){chrome.storage.local.get(null,(t=>{t.custom_server?de(t.server,t.custom_server):e?$.getJSON("/config_dynatrace.json",(function(e){de(e.server_url,t.custom_server)})):$.getJSON(o.configFile,(function(e){de(e.server_url,t.custom_server)}))}))}function ue(){c.regex_include=$("#regex_include").val(),c.regex_follow_input=$("#regex_follow_input").val(),c.requests_to_record=$("input[name='requests_to_record']:checked").val(),"mode-record"===f?(c.cookie=$("#cookie").is(":checked"),$("#record-cookies").prop("checked",c.cookie),c.random_think_time=$("#random-think-time").is(":checked"),$("#random-think-time").prop("checked",c.random_think_time)):(c.cookie=$("#record-cookies").is(":checked"),c.cookie?$("#cookie").prop("checked",!0):$("#cookie").prop("checked",!1)),c.cache=$("#cache").is(":checked"),c.service_workers=$("#service-workers").is(":checked"),c.update_settings=$("#update-settings").is(":checked"),c.record_css=$("#record-css").is(":checked"),c.record_js=$("#record-js").is(":checked"),c.record_images=$("#record-images").is(":checked"),c.record_ajax=$("#record-ajax").is(":checked"),c.functional_test=$("#functional-test").is(":checked"),c.record_redirects=$("#record-redirects").is(":checked"),c.record_other=$("#record-other").is(":checked"),c.edit_transaction_labels=!0,c.autolabel_transactions=$("#autolabel-transactions").is(":checked"),c.export_id_locators=$("#export-id-locators").is(":checked"),c.allow_context_clicks=$("#allow-context-clicks").is(":checked"),(0,o.localSave)({options:c})}function me(){l="pause",q(h),chrome.runtime.sendMessage({type:"pause_traffic"}).then((()=>{"mode-record"===b?$.enableBtn("record"):($.enableBtn("follow-record"),$.disableBtn("record"),b="mode-follow"),chrome.storage.local.set({start_recording_mode:b}),$.disableBtn("pause"),$.enableBtn("reset"),$.disableBtn("follow-pause"),$.elementStatus.html("Recording paused!"),$("#cookie, #record-js, #record-css, #record-other, #record-images, #record-ajax").prop("disabled",!1),$('input:radio[name="requests_to_record"]').prop("disabled",!1)})).catch((()=>{})),"mode-record"===f&&chrome.runtime.sendMessage({command:"pause_recording"}).catch((function(e){console.log("Failed pausing recorder: "),console.log(e)}))}function $e(){chrome.tabs.create({url:"dist/editor.html"})}function he(){chrome.windows.getCurrent().then((e=>{chrome.runtime.sendMessage({command:"setReplayWindowId",replayWindowId:e.id}).catch((()=>{}))})).then((()=>{chrome.runtime.sendMessage({command:"get_debuggerTab"}).then((e=>{chrome.storage.local.get("position-debugger",(t=>{let n=0,r=0;if(t["position-debugger"]&&(n=t["position-debugger"].left,r=t["position-debugger"].top),e.debuggerTab){const t=e.debuggerTab.id;chrome.tabs.get(t,(e=>{chrome.runtime.lastError?(console.log(chrome.runtime.lastError.message),(0,o.openPopup)("html/debugger.html",410,600,(function(){fe()}),n,r)):chrome.windows.update(e.windowId,{focused:!0},(()=>{fe()}))}))}else(0,o.openPopup)("html/debugger.html",410,600,(function(){fe()}),n,r)}))})).catch((()=>{}))}))}function fe(){window.top&&window.top.close()}function ge(e){$.elementStatus.html("Creating test..");const t=$("#load-origin").val();(0,o.localSave)({location:t});const n=$.elementName.val();let r=null;_.forEach((function(e,o){e===n&&(r=o)})),(0,o.localSave)({record_name:n}),chrome.storage.local.set({record_id:r}),$("#advanced-options-fieldset").removeClass("opened"),$("#advanced-options").hide(),ue(),chrome.runtime.sendMessage({type:"upload_traffic",testType:e.data.testType}).catch((()=>{}))}function we(){chrome.storage.local.get("mode",(function(e){"mode-follow"===e.mode?chrome.runtime.sendMessage({type:"export_jmeter_follow"}).catch((()=>{})):chrome.runtime.sendMessage({type:"export_jmeter"}).catch((()=>{}))}))}function be(){$(".openclose").attr("id","closed"),$("#advanced-options-fieldset").removeClass("opened"),$("#advanced-options").hide(),H()}function _e(){$(".openclose").attr("id","opened"),$("#advanced-options-fieldset").addClass("opened"),$("#advanced-options").show(),$(".swiper-container").css({overflow:"visible"}),H()}function ve(){$("#load-origin").html(""),k.forEach((function(e,o){$("#load-origin").append($("<option>").text(e.title).attr("value",e.id)),0===o&&$("#load-origin").val(e.id)})),$("#load-origin").trigger("chosen:updated");const e=$("#concurrency");e.slider("option","value",1),e.slider("option","max",1),$("#concurrency-display-textfield").val(1),e.slider({disabled:!0})}function ke(){chrome.storage.local.get("location",(function(e){let t=!1;$("#load-origin").html(""),Object.keys(v).length>0?(v.forEach((function(o){$("#load-origin").append($("<option>").text(o.title).attr("value",o.id)),e.location===o.id&&(t=!0)})),e.location&&t?$("#load-origin").val(e.location):($("#load-origin").val(S),(0,o.localSave)({location:S})),ee()):$("#load-origin").append($("<option>").text("US Central (Iowa, Google)").attr("value","us-central1-a")),$("#load-origin").trigger("chosen:updated")}))}async function ye(e,o){const t=await xe();await downloadSuiteScript(t,{language:e,fileFormat:o})}function xe(){return new Promise((function(e,o){chrome.runtime.sendMessage({command:"getCurrentSuite"}).then((t=>{t.suite?e(t.suite):o()})).catch((()=>{}))}))}function Be(){const e=[...$('.download-body .checkbox-wrapper input:not([name="domains"]):not(#chk-all)')].reduce(((e,o)=>{if("chk-jmx"===$(o).prop("name")){const t=$("input[name=domains]:checked").length>0;return $(o).prop("checked")?Number(t)+e:e}return $(o).prop("checked")?e+1:e}),0);!function(){const e=[...$(".download-body .include-language input")].reduce(((e,o)=>$(o).prop("checked")?e+1:e),0),o=[...$('.download-body .checkbox-wrapper input[name="domains"]')],t=o.length;console.log(e,o,t);const n=o.reduce(((e,o)=>$(o).prop("checked")?e+1:e),0);$("#domains-counter").text(n),$("#alldomains").text(t),$("#languages-counter").text(e)}(),e?$("#run-overlay .download-button").removeAttr("disabled").removeClass("disabled").text(`Save (${e})`):$("#run-overlay .download-button").attr("disabled","disabled").addClass("disabled").text(`Save (${e})`)}G.forEach((e=>{e.onclick=()=>{const o=e.closest(".notification-text-alert-inner"),t=o.querySelector(".notification-text-hide-block"),n=o.querySelector(".close-open-button.open-button");$(t).fadeOut(300),$(n).fadeIn(100),$(e).fadeOut(300)}})),actionDropdownOpenerListener(),$("#accounts, #workspaces, #projects").on("change",(function(){$("#options-fieldset-test").addClass("not-saved"),$("#save_test_options").prop("disabled",!1),$(".back-to span").html("Cancel"),"accounts"===$(this).attr("id")?($("#account-status").text(""),$(".account-loader").show(),$(".account-expand").hide(),P=!0,X(Number($(this).val()))):"workspaces"===$(this).attr("id")&&($("#account-status").text(""),$(".account-loader").show(),$(".account-expand").hide(),P=!0,z(Number($(this).val())))})),$("#save_test_options").on("click",(function(e){e.preventDefault(),chrome.storage.local.get("accountOptions",(function(e){e.accountOptions;const t=Number($("#accounts").val()),n=Number($("#workspaces").val()),r=Number($("#projects").val());$("#save_test_options").prop("disabled",!0),$("#options-fieldset-test").removeClass("not-saved"),r>0?((0,o.localSave)({accountOptions:{account:t,workspace:n,project:r,uid:g}}),oe(t,n),te(r),$("#account-status").html('<span class="message">Account Options saved!</span>'),$(".back-to span").html("Go back")):($("#save_test_options").prop("disabled",!1),n>0?$("#account-status").html('<span class="error">Workspace has no project. Please choose another one.</span>'):$("#account-status").html('<span class="error">Account has no workspace. Please choose another one.</span>'))}))})),$("input[name='requests_to_record']").on("change",(function(){switch($(this).val()){case"top_level":$(".following").hide(),$(".parallel-downloads-wrapper").show(),"other"===$("#parallel-downloads-list").find(":selected").val()&&$(".parallel-downloads-text").show(),$("#cookie, #record-js, #record-css, #record-other, #record-images").prop("checked",!1);break;case"top_level_and_following":$(".following").show(),$(".parallel-downloads-wrapper").hide(),$(".parallel-downloads-text").hide()}ue()})),$("#edit-transaction-labels").on("change",(function(){$(".autolabel-transactions-wrapper").toggle(this.checked),this.checked&&$(".swiper-container").css({overflow:"visible"})})),$(".info-button i").on("click",(function(){$(".license-info").toggle("slide")})),chrome.storage.local.get(null,(e=>{pe(!1),$("#sign-block").show(),e.time_distribution||(re(10,!0),(0,o.localSave)({time_distribution:0,auto_time_distribution:10}))})),"top_level_and_following"!==$("input[name='requests_to_record']:checked").val()&&$("#cookie, #record-js, #record-css, #record-other, #record-images").prop("checked",!1),$(".selectall").on("click",(function(){$(".include-domains :checkbox").each((function(){this.checked=!0}))})),$(".include-domains").on("click",(function(){Be()})),$(".unselectall").on("click",(function(){$(".include-domains :checkbox").each((function(){this.checked=!1}))})),$("#concurrency").slider({disabled:!0}),$("#add-concurrency").on("click",(function(){})),$(".version").html(a.version),$(".checkbox-wrapper input:checkbox").on("change",(function(){ue()})),$("#regex_include").on("keyup",(function(){ue()})),$("#regex_include").on("change",(function(){})),$("#regex_follow_input").on("change",(function(){})),$("#functional-test").on("change",(function(){if(chrome.storage.local.get("accountOptions",(e=>{te(e.accountOptions.project)})),$(this).is(":checked"))ve();else{const e=$("#concurrency");e.slider({disabled:!1}),e.slider("option","value","1"),e.slider("option","max",C),ke()}})),$.getJSON(chrome.runtime.getURL("js")+"/useragentswitcher.json",(function(e){const o=[],t=$("#user-agents-list");return t.append('<option value="Current Browser">Current Browser</option>'),$.each(e,(function(e,t){if(void 0!==t.useragent&&o.push(t),void 0!==t.folder){const e=t.folder;void 0!==e.useragent&&o.push(e),$.each(e,(function(e,t){void 0!==t.useragent&&o.push(t),void 0!==t.folder&&$.each(t.folder,(function(e,t){o.push(t)}))}))}})),$.each(o,(function(e,o){if("UA List :: About"!==o._description){let e='<optgroup label="'+o._description+'">'+o._description+"</optgroup>";void 0!==o.useragent&&($.each(o.useragent,(function(t,n){let r;"string"==typeof n?(r='<option value="'+o.useragent._useragent+'">'+o.useragent._description+"</option>",e+=r):(r='<option value="'+n._useragent+'">'+n._description+"</option>",e+=r)})),t.append(e))}})),chrome.storage.local.get("options",(e=>{e.options&&e.options.useragent?$("#user-agents-list").val(e.options.useragent):$("#user-agents-list").val("Current Browser"),t.chosen()})),!1})),$(".onoffswitch-checkbox").on("click",(function(e){"stopped"!==l?e.preventDefault():(f=$(this).val(),chrome.storage.local.get("disable_followme",(function(e){"TRUE"===e.disable_followme&&(f="mode-record"),ce(),chrome.storage.local.set({mode:f}),chrome.runtime.sendMessage({type:"switch_mode"}).catch((()=>{})),"stopped"!==l&&"pause"!==l&&($.elementStatus.html(""),$.disableBtn("record"),$.enableBtn("pause"),$.enableBtn("stop"));let o="Record"})))})),$("#concurrency-display-textfield").on("change",(function(){let e=parseInt($(this).val(),10);chrome.storage.local.get("real_max_follow_limit",(function(t){const n=parseInt(t.real_max_follow_limit,10);if(isNaN(e))e=O,$("#concurrency-display-textfield").val(O);else if("follow"===l){const o=$("#concurrency").slider("option","max");e>o&&($("#concurrency").slider("value",o),$("#concurrency-display-textfield").val(o),e=o)}e>n&&(e=n,$("#concurrency-display-textfield").val(e)),$("#concurrency").slider("value",e),(0,o.localSave)({concurrency:e})}))})),$("#load-origin").on("change",(function(){(0,o.localSave)({location:$(this).val()}),ee()})),$("#parallel-downloads-list").on("chosen:hiding_dropdown",(function(){$("#parallel_downloads_list_chosen > div > ul > li").remove()})),$("#parallel-downloads-list").on("change",(function(e,t){(0,o.localSave)({parallelDownloadsList:$(this).val()}),"other"===$(this).val()?$(".parallel-downloads-text").show():($(".parallel-downloads-text").hide(),(0,o.localSave)({parallel_downloads:$(this).find(":selected").data("value")}))})),$("#cookie, #record-js, #record-css, #record-other, #record-images").on("change",(function(){$(this).is(":checked")&&$('input:radio[name="requests_to_record"]').filter('[value="top_level_and_following"]').prop("checked",!0),ue()})),$("#update-settings").on("change",(function(){I&&($(this).is(":checked")?($("#button-upload-jmeter input").attr("title",p),$("#upload-off input").attr("title",p)):($("#button-upload-jmeter input").attr("title",d),$("#upload-off input").attr("title",d)))})),$("#record").find("input").tooltip(),$(".onoffswitch-label").tooltip(),$("#record-off").find("input").tooltip(),$("#upload").find("input").tooltip(),$("#upload-off").find("input").tooltip(),$("#follow-record").find("input").tooltip(),$("#follow-record-off").find("input").tooltip(),$("#follow-stop").find("input").tooltip(),$("#follow-stop-off").find("input").tooltip(),$("#reset").find("input").tooltip(),$("#reset-off").find("input").tooltip(),$("#follow-reset").find("input").tooltip(),$("#follow-reset-off").find("input").tooltip(),$(".tooltip-btn").tooltip(),$("#add-concurrency").tooltip(),$(".description a").tooltip(),$(".time-distribution-wrapper label").attr("title",u),$(".time-distribution-display").attr("title",u),$(".time-distribution-wrapper label").tooltip(),$(".time-distribution-display").tooltip(),$(".description").tooltip(),$.elementName.on("keyup",(function(){(0,o.localSave)({record_name:$(this).val(),jmxname:$(this).val()}),$(this).val()&&$(this).val();const e=(0,n.stringIsEmpty)($.elementName.val());chrome.runtime.sendMessage({type:"traffic_exists"}).then((o=>{e?($.disableBtn("debugger"),$.disableBtn("download"),$.disableBtn("upload"),$.disableBtn("upload-jmx")):($.enableBtn("download"),$.enableBtn("debugger"),I&&($.enableBtn("upload"),$.enableBtn("upload-jmx"))),function(e,o){o&&!e?$.enableBtn("edit"):$.disableBtn("edit")}(e,o)})).catch((()=>{}))})),$("#parallel_downloads").on("change",(function(){const e=function(e){let o=parseInt(e.val(),10);const t=parseInt(e.attr("min"),10),n=parseInt(e.attr("max"),10);return isNaN(o)?(o=t,e.val(t)):(void 0!==t&&o<t&&(o=t,e.val(t)),void 0!==n&&o>n&&(o=n,e.val(n))),o}($(this));(0,o.localSave)({parallel_downloads:e})})),$("#follow-name").on("keyup",(function(){if($(this).val().replace(/ /g,"").length<1)$.disableBtn("follow-record");else{(0,o.localSave)({test_name:$(this).val(),jmxname:$(this).val()});const e=$("#regex_follow_input").val();I&&e.replace(/ /g,"").length>0&&!(0,n.stringIsEmpty)(e)&&$.enableBtn("follow-record")}})),$("#regex_follow_input").on("keyup",(function(){if($(this).val().replace(/ /g,"").length<1)$.disableBtn("follow-record");else{const e=$("#follow-name").val();I&&e.replace(/ /g,"").length>0&&!(0,n.stringIsEmpty)(e)&&"stopped"===l&&$.enableBtn("follow-record")}ue(),chrome.runtime.sendMessage({type:"change_regex_follow_input"}).catch((()=>{}))})),N(),D(),A(),chrome.storage.local.get(null,(function(e){chrome.storage.local.get(null,(function(t){I=t.logged,"{}"!==JSON.stringify(e)&&(e.record_name&&$("#name").val(e.record_name),e.test_name&&$("#follow-name").val(e.test_name),e.options&&(c=e.options,void 0===c.export_id_locators&&(c.export_id_locators=!0),void 0===c.allow_context_clicks&&(c.allow_context_clicks=!1),c.regex_follow_input?$("#regex_follow_input").val(c.regex_follow_input):$("#regex_follow_input").val(""),c.regex_include?$("#regex_include").val(c.regex_include):$("#regex_include").val("http://*/*, https://*/*"),$('input:radio[name="requests_to_record"]').filter('[value="'+c.requests_to_record+'"]').prop("checked",!0),$("#cache").prop("checked",c.cache),$("#service-workers").prop("checked",c.service_workers),$("#cookie").prop("checked",c.cookie),$("#record-cookies").prop("checked",c.cookie),$("#update-settings").prop("checked",c.update_settings),$("#record-css").prop("checked",c.record_css),$("#record-js").prop("checked",c.record_js),$("#record-images").prop("checked",c.record_images),$("#record-ajax").prop("checked",c.record_ajax),$("#functional-test").prop("checked",c.functional_test),$("#record-redirects").prop("checked",c.record_redirects),$("#record-other").prop("checked",c.record_other),$("#edit-transaction-labels").prop("checked",c.edit_transaction_labels),$("#autolabel-transactions").prop("checked",c.autolabel_transactions),$("#random-think-time").prop("checked",c.random_think_time),$("#export-id-locators").prop("checked",c.export_id_locators),$("#allow-context-clicks").prop("checked",c.allow_context_clicks),c.edit_transaction_labels&&($(".autolabel-transactions-wrapper").show(),$(".swiper-container").css({overflow:"abort-testvisible"})),"top_level_and_following"===c.requests_to_record&&($(".following").show(),$(".parallel-downloads-wrapper").hide(),$(".parallel-downloads-text").hide())),e.parallel_downloads?$("#parallel_downloads").val(e.parallel_downloads):($("#parallel_downloads").val($("#parallel_downloads").attr("data-default")),(0,o.localSave)({parallel_downloads:$("#parallel_downloads").attr("data-default")})),e.parallelDownloadsList&&($("#parallel-downloads-list").val(e.parallelDownloadsList).trigger("chosen:updated"),"other"===e.parallelDownloadsList&&"top_level"===c.requests_to_record&&$(".parallel-downloads-text").show())),e.concurrency||(0,o.localSave)({concurrency:O}),$("#concurrency").slider({range:"max",min:1,max:C,value:e.concurrency,slide(e,o){ae(o.value)},change(e,o){le(o.value)},stop(e,o){}}),$("#time-distribution").slider({range:"max",min:0,max:300,step:10,value:e.time_distribution,slide(e,t){var n;n=t.value,(0,o.localSave)({time_distribution:n}),chrome.storage.local.get("concurrency",(e=>{0===n?ne(e.concurrency):re(n)}))},stop(e,o){}}),"0"==e.time_distribution?ne(e.concurrency):(re(e.time_distribution),$("#time-distribution").slider("option","value",e.time_distribution)),Be(),void 0===t.mode?(f="mode-record",b="mode-record",chrome.storage.local.set({start_recording_mode:"mode-record",mode:"mode-record"})):(f=t.mode,b=t.start_recording_mode),chrome.runtime.sendMessage({type:"get_status"}).then((e=>{l=e.op,ce(),"record"===l?(q(m),$.disableBtn("record"),$.disableBtn("reset"),$.enableBtn("pause"),$.enableBtn("stop"),$("#cookie, #record-js, #record-css, #record-other, #record-images, #record-ajax, #edit-transaction-labels").prop("disabled",!0),$('input:radio[name="requests_to_record"]').prop("disabled",!0)):"follow"===l?($.disableBtn("follow-record"),$.disableBtn("follow-reset"),$.enableBtn("follow-pause"),$.enableBtn("follow-stop"),$.enableBtn("follow-report"),$("#load-origin").prop("disabled",!0).trigger("chosen:updated"),$("#follow-name").prop("disabled",!0),$("#add-concurrency").hide(),$.disableBtn("record"),$.disableBtn("reset"),$.enableBtn("pause"),$.enableBtn("stop")):"pause"===l?(q(h),$.enableBtn("follow-stop"),$("#load-origin").prop("disabled",!0).trigger("chosen:updated"),$("#follow-name").prop("disabled",!0),$.enableBtn("stop"),$.disableBtn("follow-pause"),$.enableBtn("follow-record"),$.disableBtn("pause"),$.enableBtn("reset"),$("#cookie, #record-js, #record-css, #record-other, #record-images, #record-ajax").prop("disabled",!1),$('input:radio[name="requests_to_record"]').prop("disabled",!1),$("#edit-transaction-labels").prop("disabled",!0),"mode-record"===b?$.enableBtn("record"):$.disableBtn("record")):"waiting"===l?$.waitOverlay(1):"stopped"===l?(t.test_id&&$.enableBtn("follow-report"),$("#cookie, #record-js, #record-css, #record-other, #record-images, #record-ajax, #edit-transaction-labels").prop("disabled",!1),$('input:radio[name="requests_to_record"]').prop("disabled",!1),chrome.runtime.sendMessage({type:"traffic_exists"}).then((e=>{chrome.runtime.sendMessage({command:"getCurrentSuite"}).then((o=>{chrome.storage.local.get("test_name",(function(t){!e&&!o.suite||(0,n.stringIsEmpty)(t.record_name)?($.disableBtn("edit"),$.disableBtn("download"),$.disableBtn("debugger"),$.disableBtn("upload"),$.disableBtn("upload-jmx")):($("#recording-actions").addClass("opened"),"mode-record"===f&&R(!1),chrome.runtime.sendMessage({type:"has_current_suite"}).then((o=>{o&&!(0,n.stringIsEmpty)($.elementName.val())?($.enableBtn("download"),e&&$.enableBtn("edit"),I&&$.enableBtn("upload")):($.disableBtn("edit"),$.disableBtn("upload"))})).catch((()=>{})),L(e),o.suite?$.enableBtn("debugger"):$.disableBtn("debugger"))}))})).catch((()=>{}))})).catch((()=>{})),chrome.runtime.sendMessage({type:"traffic_exists_follow"}).then((e=>{e&&($.enableBtn("follow-report"),$.enableBtn("follow-upload-jmx"))})).catch((()=>{}))):($.enableBtn("record"),$.enableBtn("reset"),$.disableBtn("pause"),$.disableBtn("stop"))})).catch((()=>{})),e.stopped_test&&$.testEndedOverlay()}))})),$.resetRecording=function(){l="stopped",$.elementName.val(""),b="",$("#regex_include").removeClass("text-error"),chrome.storage.local.set({start_recording_mode:""}),$("#concurrency").slider({disabled:!0}),$(".parallel-downloads-wrapper").show(),q(m),t(),chrome.runtime.sendMessage({type:"reset_traffic"}).then((()=>{(0,o.localSave)({test_name:"",location:S,record_name:"",concurrency:O,time_distribution:0}),chrome.storage.local.set({test_id:null,record_id:null}),$("#concurrency").slider("option","value",O),$("#time-distribution").slider("option","value","0"),ne(0),$("#concurrency-textfield").val(0),(0,o.localSave)({location:S}),$("#load-origin").prop("disabled",!1).trigger("chosen:updated"),$("#follow-name").prop("disabled",!1),$("#user-agents-list").val("Current Browser"),$("#user-agents-list").trigger("chosen:updated"),chrome.storage.local.get(null,(e=>{e.test_name?$("#follow-name").val(e.test_name):$("#follow-name").val(""),N();const o=e.concurrency;$("#concurrency").slider("option","value",o),$("#concurrency-display-textfield").val(o),e.location?$("#load-origin").val(e.location):$("#load-origin").val(S)})),c.requests_to_record="top_level",c.record_ajax=!0,c.functional_test=!1,c.cookie=!1,c.record_css=!1,c.record_js=!1,c.record_images=!1,c.record_redirects=!1,c.record_other=!1,c.edit_transaction_labels=!1,c.autolabel_transactions=!1,c.cache=!0,c.service_workers=!0,c.random_think_time=!0,c.update_settings=!1,c.regex_include="http://*/*, https://*/*",c.regex_follow_input="",c.useragent="Current Browser",(0,o.localSave)({options:c,record_name:"",jmxname:"",parallel_downloads:$("#parallel_downloads").attr("data-default")}),$.elementName.val(""),$("#regex_follow_input").val(""),$("#regex_include").val(c.regex_include),$('input:radio[name="requests_to_record"]').filter('[value="'+c.requests_to_record+'"]').prop("checked",!0),$("#regex_follow_input").prop("checked",c.regex_follow_input),$("#cookie").prop("checked",c.cookie),$("#record-cookies").prop("checked",c.cookie),$("#cache").prop("checked",c.cache),$("#service-workers").prop("checked",c.service_workers),$("#update-settings").prop("checked",c.update_settings),$("#record-css").prop("checked",c.record_css),$("#record-js").prop("checked",c.record_js),$("#record-images").prop("checked",c.record_images),$("#record-ajax").prop("checked",c.record_ajax),$("#functional-test").prop("checked",c.functional_test),$("#record-redirects").prop("checked",c.record_redirects),$("#record-other").prop("checked",c.record_other),$("#edit-transaction-labels").prop("checked",c.edit_transaction_labels),$("#autolabel-transactions").prop("checked",c.autolabel_transactions),$("#random-think-time").prop("checked",c.random_think_time),$(".autolabel-transactions-wrapper").hide(),$("#parallel-downloads-list").val("Chrome").trigger("chosen:updated").trigger("change",["reset"]),$("#parallel_downloads").val($("#parallel_downloads").attr("data-default")),$(".following").hide(),be(),I&&W(!0),D(),$.elementStatus.html("Options were reset"),chrome.action.setBadgeText({text:""}),$("#concurrency").slider({disabled:!1}),chrome.runtime.sendMessage({command:"reset_recording"}).catch((function(e){console.log("Failed reseting recorder: "),console.log(e)}))})).catch((()=>{}))},$.stopRecording=function(){t(),q(m),$("#user-agents-list").prop("disabled",!1).trigger("chosen:updated"),$('input:radio[name="requests_to_record"]').prop("disabled",!1),$("#cache").prop("disabled",!1),$("#service-workers").prop("disabled",!1),$("#cookie").prop("disabled",!1),$("#record-css").prop("disabled",!1),$("#record-js").prop("disabled",!1),$("#record-images").prop("disabled",!1),$("#record-ajax").prop("disabled",!1),$("#edit-transaction-labels").prop("disabled",!1),$("#record-other").prop("disabled",!1),l="stopped",chrome.runtime.sendMessage({type:"stop_traffic"}).then((()=>{chrome.storage.local.get(null,(function(e){"mode-follow"===f?($.disableBtn("follow-pause"),$.disableBtn("follow-stop"),$.enableBtn("follow-record"),$.enableBtn("follow-reset"),$("#load-origin").prop("disabled",!1).trigger("chosen:updated"),$("#follow-name").prop("disabled",!1),$("#overlay").remove()):($.disableBtn("pause"),$.disableBtn("stop"),$.enableBtn("record"),$.enableBtn("reset")),"mode-record"!==b&&($.disableBtn("follow-pause"),$.disableBtn("follow-stop"),$.enableBtn("follow-record"),$.enableBtn("follow-reset"),$("#load-origin").prop("disabled",!1).trigger("chosen:updated"),$("#follow-name").prop("disabled",!1),$("#concurrency").slider("option","max",e.real_max_follow_limit),$("#overlay").remove(),$.disableBtn("pause"),$.disableBtn("stop"),$.enableBtn("record"),$.enableBtn("reset")),chrome.runtime.sendMessage({type:"traffic_exists"}).then((t=>{chrome.runtime.sendMessage({command:"getCurrentSuite"}).then((r=>{(t||r.suite)&&((0,n.stringIsEmpty)(e.record_name)&&chrome.runtime.sendMessage({type:"get_status"}).then((e=>{l=e.op;let t=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");const r=+t.substr(0,2),a=r<12?" AM":" PM";for(t=(r%12||12)+t.substr(2,6)+a;t.indexOf(":")>0;)t=t.replace(":",".");const s=$.datepicker.formatDate("mm-dd-y",new Date);let i=$.elementName.val();(0,n.stringIsEmpty)(i)&&($.elementName.val("RECORD "+s+" "+t),i="RECORD "+s+" "+t),(0,o.localSave)({options:c,record_name:i,jmxname:i})})).catch((()=>{})),t&&$.enableBtn("edit"),$.enableBtn("download"),$.enableBtn("debugger"),"mode-record"===f&&(R(!0),L(t)),I&&($.enableBtn("upload"),$.enableBtn("upload-jmx")))})).catch((()=>{}))})).catch((()=>{})),chrome.runtime.sendMessage({type:"traffic_exists_follow"}).then((e=>{e&&($.enableBtn("follow-upload-jmx"),$.enableBtn("follow-report"))})).catch((()=>{})),b="",chrome.storage.local.set({start_recording_mode:""}),"mode-follow"===f?($.elementStatus.html("FollowMe test stopped!"),chrome.action.setBadgeText({text:""})):$.elementStatus.html("Recording stopped!")}))})).catch((()=>{})),"mode-record"===f&&chrome.runtime.sendMessage({command:"stop_recording"}).catch((function(e){console.log("Failed stopping recorder: "),console.log(e)}))},$(".main_popup").on("click",(function(e){$("html,body").scrollTop(0),2===e.which&&e.preventDefault();const o=$(".notification-text-alert");o.is(e.target)||0!==o.has(e.target).length||H()})),F(),$.elementUploadJmeter.on("click",{testType:"jmeter"},ge),$.elementUploadSelenium.on("click",{testType:"selenium"},ge),$("#button-upload-jmeter-dropdown").on("click",{testType:"jmeter"},ge),$("#button-upload-selenium-dropdown").on("click",{testType:"selenium"},ge),$("#button-upload-combined-dropdown").on("click",{testType:"combinedJmeterAndSelenium"},ge),$("#button-upload-browser-dropdown").on("click",{testType:"performanceGui"},ge),$.elementUploadJmx.on("click",we),$("#button-edit-jmeter").on("click",$e),$("#button-edit-selenium").on("click",he),$("#button-edit-jmeter-dropdown").on("click",$e),$("#button-edit-selenium-dropdown").on("click",he),$("#record-off").on("click",me),$("#stop").on("click",$.stopRecording),$("#record").on("click",(function(){if(!function(e){for(const t of e.split(","))if(!(0,o.validateMatchPattern)(t.trim()))return!1;return!0}($("#regex_include").val()))return $.elementStatus.html("Incorrect Filter pattern!"),!1;chrome.action.setBadgeText({text:""}),(0,o.localSave)({"chk-taurus":!0}),$("#regex_include").removeClass("text-error");let e=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");const t=+e.substr(0,2),r=t<12?" AM":" PM";for(e=(t%12||12)+e.substr(2,6)+r;e.indexOf(":")>0;)e=e.replace(":",".");const a=$.datepicker.formatDate("mm-dd-y",new Date);if((0,n.stringIsEmpty)($.elementName.val())){const o="RECORD "+a+" "+e;$.elementName.val(o),chrome.runtime.sendMessage({type:"set_default_test_name",payload:o}).catch((()=>{}))}(0,o.localSave)({record_name:$.elementName.val(),jmxname:$.elementName.val()}),$.elementName.val(),b=f,chrome.storage.local.set({start_recording_mode:f}),ue(),$.disableBtn("edit"),$.disableBtn("download"),$.disableBtn("debugger"),$.disableBtn("upload"),$.disableBtn("upload-jmx"),$.disableBtn("reset"),$('input:radio[name="requests_to_record"]').prop("disabled",!0),$("#cache").prop("disabled",!0),$("#service-workers").prop("disabled",!0),$("#cookie").prop("disabled",!0),$("#record-css").prop("disabled",!0),$("#record-js").prop("disabled",!0),$("#record-images").prop("disabled",!0),$("#record-ajax").prop("disabled",!0),$("#edit-transaction-labels").prop("disabled",!0),$("#record-other").prop("disabled",!0),$("#update-settings").prop((function(){ue()})),$.elementStatus.html(""),$.disableBtn("record"),$.enableBtn("pause"),$.enableBtn("stop"),chrome.runtime.sendMessage({type:"start_traffic"}).catch((()=>{})),"stopped"===l?chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(e.length>0&&e[0].hasOwnProperty("id")){const o={command:"start_recording",suite_name:$.elementName.val(),recordingTab:e[0]};chrome.runtime.sendMessage(o).then((e=>{e.error||window.top.close()})).catch((()=>{}))}})):"pause"===l&&chrome.runtime.sendMessage({command:"resume_recording"}).catch((function(e){console.log("Failed stopping recorder: "),console.log(e)})),l="record"})),$("#reset").on("click",$.resetRecording),$("#download").on("click",(function(){chrome.runtime.sendMessage({type:"get_traffic"}).then((e=>{e=JSON.parse(e);const o={};if(jQuery.isEmptyObject(e))$("#chk-jmx").attr("disabled","disabled").prop("checked",!1),$('label[for="chk-jmx"]').text("JMeter only (JMX) - No JMeter traffic recorded"),$('label[for="chk-jmx"]').prepend($('<div class="disabled-checkbox"></div>')),$("#run-overlay .download-body .domains-body").hide(),$("#chk-taurus").attr("disabled","disabled").prop("checked",!1),$('label[for="chk-taurus"]').html("JMeter & Selenium combined (YAML) - No JMeter traffic recorded"),$('label[for="chk-taurus"]').prepend($('<div class="disabled-checkbox"></div>'));else for(const t of Object.keys(e)){const n=(0,r.parseURL)(e[t].url);o[n]||(o[n]=n)}xe().then((e=>{jQuery.isEmptyObject(e)&&($("#chk-yaml").attr("disabled","disabled").prop("checked",!1),$('label[for="chk-yaml"]').text("Selenium (YAML) - No actions recorded"))}),(()=>{$("#chk-yaml").attr("disabled","disabled").prop("checked",!1),$('label[for="chk-yaml"]').text("Selenium (YAML) - No actions recorded")})),$("#chk-jmx").prop("checked")&&I&&$("#run-overlay .download-body .domains-body").show(),I||$("#chk-jmx-wrapper").hide(),$("#run-overlay .top-overlay-title").html("Download your scripts"),$.elementStatus.html(""),$.elementRunOverlayClose.off("click"),$.elementRunOverlayClose.on("click",$.closeOverlay),$.domainDownloadOverlay(o)})).catch((()=>{}))})),$("#chk-all").on("click",(function(){$(this).prop("checked")?$(".languages-body").show():($(".languages-body").hide(),[...$(".download-body .languages-body input")].forEach((e=>{$(e).prop("checked",!1)})),Be())})),$("#chk-jmx").on("click",(function(){(0,o.localSave)({"chk-jmx":$(this).prop("checked")}),Be(),$(this).prop("checked")?$("#run-overlay .download-body .domains-body").show():$("#run-overlay .download-body .domains-body").hide()})),$(".download-body .checkbox-wrapper input").on("click",(function(){Be()})),$("#chk-taurus").on("click",(function(){(0,o.localSave)({"chk-taurus":$(this).prop("checked")}),Be()})),$("#run-overlay .download-button").on("click",(async function(){const e=$("#chk-yaml").prop("checked"),o=$("#chk-jmx").prop("checked"),t=$("#chk-taurus").prop("checked"),n=$("#chk-cs-wd-nunit").prop("checked"),r=$("#chk-cs-wd-mstest").prop("checked"),a=$("#chk-java-wd-testng").prop("checked"),l=$("#chk-java-wd-junit").prop("checked"),c=$("#chk-java-rc-junit").prop("checked"),s=$("#chk-python-wd-unittest").prop("checked"),i=$("#chk-ruby-wd-rspec").prop("checked"),d=$("#chk-xml").prop("checked");e&&await async function(){chrome.runtime.sendMessage({command:"dumpCurrentSuiteYaml"}).then((e=>{const o=new Blob([e.yaml],{type:"text/plain"}),t=window.URL.createObjectURL(o);var n=$("<a>Download</a>");n.attr("download",e.filename),n.attr("href",t),n[0].click(),n.remove()})).catch((()=>{}))}(),t&&chrome.runtime.sendMessage({type:"getCombinedYamlFile"}).then((e=>{const{combinedYaml:o,fileName:t}=e;downloadCombinedYaml(t,o)})).catch((()=>{})),n&&await ye("cs-wd-nunit","cs"),r&&await ye("cs-wd-mstest","cs"),a&&await ye("java-wd-testng","java"),l&&await ye("java-wd-junit","java"),c&&await ye("java-rc-junit","java"),s&&await ye("python-wd-unittest","py"),i&&await ye("ruby-wd-rspec","rb"),d&&await ye("xml","xml"),o&&I&&$.exportSelectedDomains(),o||$.closeOverlay()})),$("#advanced-options-fieldset").on("click",(function(){return $("#advanced-options-fieldset").hasClass("opened")?("mode-record"===f&&$("#advanced-options").removeClass("openedRecord"),be(),!1):("mode-record"===f&&$("#advanced-options").addClass("openedRecord"),_e(),!1)})),$(".slide-to").on("click",(function(){I&&function(e){$(".swiper-container")[0].swiper.slideTo(e),"1"===e?($(".swiper-container").css({overflow:"hidden"}),$(".back-to span").html("Cancel"),$("#account-status").text("")):$(".swiper-container").css({overflow:"visible"});const o=$(".swiper-slide-active").height();window.parent.postMessage({height:o},"*")}($(this).attr("data-page"))})),$(".cancel-account").on("click",(function(){P=!1,V(),$("#save_test_options").prop("disabled",!0)})),$("#follow-record").on("click",(function(){if(!function(e){for(const t of e.split(","))if(/(http(s?))\/\//gi.test(o=t)||!(o.search(/\./)>0))return!1;var o;return!0}($("#regex_follow_input").val()))return $.elementStatus.html("Incorrect Domains to Follow!"),!1;ue(),(0,o.localSave)({jmxname:$("#follow-name").val()}),"pause"!==l?chrome.storage.local.get("concurrency",(function(e){chrome.runtime.sendMessage({command:"reset_recording"}).catch((function(e){console.log("Failed reseting recorder: "),console.log(e)})),D(),l="waiting",$.elementStatus.html("Starting test.."),$.disableBtn("follow-report"),$.disableBtn("follow-upload-jmx"),b=f;const t=e.concurrency;$("#concurrency").slider("option","max",t);let r=$("#follow-name").val(),a=null;_.forEach((function(e,o){e===r&&(a=o)})),(0,n.stringIsEmpty)($("#follow-name").val())&&(r="Follow Me "+function(){const e=new Date,o=e.getFullYear()-2e3;let t=e.getMonth()+1,n=e.getDate(),r=e.getHours(),a=e.getMinutes(),l=e.getSeconds();return 1===t.toString().length&&(t="0"+t),1===n.toString().length&&(n="0"+n),1===r.toString().length&&(r="0"+r),1===a.toString().length&&(a="0"+a),1===l.toString().length&&(l="0"+l),t+"/"+n+"/"+o+" "+(r<10?"0":""+(r>12?r-12:r))+":"+a+":"+l+" "+(r>12?"PM":"AM")}(),$("#follow-name").val(r));const c=$("#load-origin").val();(0,o.localSave)({max_concurrent_users:t,test_name:r,location:c}),chrome.storage.local.set({start_recording_mode:f,test_id:a})})):($.disableBtn("follow-record"),$.enableBtn("follow-pause"),$.enableBtn("pause")),$.disableBtn("follow-reset"),$.disableBtn("reset"),$.elementStatus.html(""),$.enableBtn("stop"),chrome.runtime.sendMessage({type:"follow_traffic"}).catch((()=>{}))})),$("#follow-stop").on("click",$.stopRecording),$("#follow-pause").on("click",me),$("#follow-upload-jmx").on("click",we),$("#follow-report").on("click",(function(){chrome.storage.local.get(null,(function(e){const o=e.accountOptions;o&&e.testSessionId&&chrome.tabs.create({url:w+"/app/#/accounts/"+o.account+"/workspaces/"+o.workspace+"/projects/"+o.project+"/masters/"+e.testSessionId+"/summary"})}))})),$("#follow-reset").on("click",$.resetRecording),$.elementRunOverlayClose.on("click",$.closeOverlay),$("#user-agents-list").on("click",(function(){c.useragent=$(this).val(),(0,o.localSave)({options:c}),chrome.runtime.sendMessage({type:"change_useragent",action:$(this).val()}).catch((()=>{}))})),document.querySelectorAll(".chosen-single").forEach((function(e){e.onclick=function(){H()}})),async function(){try{const e=await fetch("https://help.blazemeter.com/docs/guide/recorders-chrome-extension-changelog.html");return(new DOMParser).parseFromString(await e.text(),"text/html").querySelector("#mc-main-content").innerText.match(/[0-9.]+/)[0]}catch(e){if(e instanceof Error)throw new Error("Cannot get latest version: "+e.message)}}().then((e=>{(function(e,o){const t=e.split("."),n=o.split("."),r=Math.max(t.length,n.length);for(let e=0;e<r;e++){const o=Number(t[e])||0,r=Number(n[e])||0;if(o!==r)return o-r>0}return!1})(e,a.version)&&document.getElementById("new-version-alert").classList.remove("hidden")}))})),chrome.runtime.onMessage.addListener((function(e){e.status?e.link?$.elementStatus.html(e.status+' <a href="'+e.link+'">See more.</a>'):$.elementStatus.html(e.status):e.waiting?"failed"===e.waiting?(l="stopped",N(),D(),$("#follow-name").prop("disabled",!1),$("#overlay").remove()):($.disableBtn("follow-record"),$.disableBtn("follow-reset"),$.enableBtn("follow-pause"),$.enableBtn("follow-stop"),$.enableBtn("follow-report"),$("#load-origin").prop("disabled",!0).trigger("chosen:updated"),$("#follow-name").prop("disabled",!0),$("#add-concurrency").hide(),chrome.storage.local.get("test_name",(function(e){e.test_name&&$("#follow-name").val(e.test_name)}))):"progressbar"===e.op?e.progress?(e.follow?($("#got-it:visible").length>0&&$("#got-it").hide(),$.elementRunOverlayClose.hide(),$(".test-ended-body").hide(),$.elementProgresBodyP.text("Launching servers in the cloud can take about 2 minutes."),$.elementProgresBodyH4.text("Please wait while cloud servers are being launched.")):($.elementRunOverlayClose.show(),$("#update-settings").is(":checked")?($(".text p").text(""),$(".text h4").text("Uploading your data."),$.elementRunOverlayClose.hide()):($.elementProgresBodyP.text("Launching servers in the cloud can take about 2 minutes."),$.elementProgresBodyH4.text("Please wait while cloud servers are being launched."))),null!=e.test_id?($.elementProgressButton.on("click",$.dismissTest),$.elementProgressButton.show()):($.elementProgressButton.off("click"),$.elementProgressButton.hide(),$.elementRunOverlayClose.off("click"),$.elementRunOverlayClose.on("click",$.cancelTest)),$.waitOverlay(e.progress)):($.elementRunOverlayProgress.hide(),$.closeOverlay(),e.followstopped&&chrome.storage.local.get("real_max_follow_limit",(function(e){$("#concurrency").slider("option","max",e.real_max_follow_limit)}))):"domainoverlay"===e.op?($.elementStatus.html(""),$.elementRunOverlayClose.off("click"),$.elementDomainsButton.off("click"),"upload"===e.action?($.elementRunOverlayClose.on("click",$.closeOverlay),$.elementRunOverlayClose.on("click",$.cancelTest),$.elementDomainsButton.on("click",$.uploadSelectedDomains)):"export"===e.action&&($.elementRunOverlayClose.on("click",$.closeOverlay),$.elementDomainsButton.on("click",$.exportSelectedDomains)),$.domainOverlay(JSON.parse(e.domains))):"testendedoverlay"===e.op?($.elementStatus.html(""),$.testEndedOverlay()):"test_ended_on_backend"===e.op?($.elementStatus.html(""),$(".test-ended-body .text p").text("Your FollowMe session has came to its end, please start new session"),$.testEndedOverlay()):"stop_recording"===e.op?($.stopRecording(),e.msg&&setTimeout((function(){$.elementStatus.html(e.msg)}),1e3),"filter_pattern_error"===e.action&&$("#regex_include").addClass("text-error")):"network_error"===e.op?$.resetRecording():"exportJMX"===e.op?e.exporting&&($.elementProgressButton.hide(),$.elementProgresBodyP.text(""),$.elementProgresBodyH4.text($.stringExporting),e.progress<100&&$.waitOverlay(e.progress)):"exported_to_jmx"===e.op?($.closeOverlay(),downloadFile("",e.jmxHref)):"closeOverlay"===e.op?$.closeOverlay():"uploadDataFailed"===e.op?($.cancelTest(),$.closeOverlay(),setTimeout((function(){$.elementStatus.html("Sending data failed. Please try again.")}),1500)):"testTerminated"===e.op?$.stopRecording():"uploadJMXFailed"===e.op&&($.closeOverlay(),$.cancelTest(),setTimeout((function(){$.elementStatus.html("Upload data failed.")}),1500))}));const F=()=>{chrome.storage.local.get(null,(e=>{if(e?.account_plan&&e?.features){const o=["freetier","Free-Trial_Weekly","Free-Trial_Monthly","Free-Trial","BASIC-MONTHLY","BASIC-ANNUAL","PRO-MONTHLY","PRO-ANNUAL"],t=e.account_plan?.isFreeTier,n=e.features?.browserPerformanceTest;!n||t||o.includes(e.account_plan?.id)?($("#button-upload-browser-dropdown").hide(),$("#button-upload-browser-dropdown-off").show()):($("#button-upload-browser-dropdown").show(),$("#button-upload-browser-dropdown-off").hide())}}))}})()})();